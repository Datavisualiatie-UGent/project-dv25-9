import*as L from"../d3-dispatch@1.0.6/index.538a7004.js";function N(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function X(r){return r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Y=X(L);const R=Y.dispatch,C=Math.PI/180,$={archimedean:Q,rectangular:lt},O=64,W=2048;var tt=function(){var r=[256,256],t=rt,i=nt,s=et,f=E,l=E,c=at,g=ut,w=Q,M=[],b=1/0,p=R("word","end"),h=null,z=Math.random,e={},I=ht;e.canvas=function(n){return arguments.length?(I=D(n),e):I},e.start=function(){var n=F(I()),u=ct((r[0]>>5)*r[1]),y=null,d=M.length,k=-1,q=[],m=M.map(function(o,a){return o.text=t.call(this,o,a),o.font=i.call(this,o,a),o.style=f.call(this,o,a),o.weight=l.call(this,o,a),o.rotate=c.call(this,o,a),o.size=~~s.call(this,o,a),o.padding=g.call(this,o,a),o}).sort(function(o,a){return a.size-o.size});return h&&clearInterval(h),h=setInterval(T,0),T(),e;function T(){for(var o=Date.now();Date.now()-o<b&&++k<d&&h;){var a=m[k];a.x=r[0]*(z()+.5)>>1,a.y=r[1]*(z()+.5)>>1,it(n,a,m,k),a.hasText&&P(u,a,y)&&(q.push(a),p.call("word",e,a),y?ft(y,a):y=[{x:a.x+a.x0,y:a.y+a.y0},{x:a.x+a.x1,y:a.y+a.y1}],a.x-=r[0]>>1,a.y-=r[1]>>1)}k>=d&&(e.stop(),p.call("end",e,q,y))}},e.stop=function(){h&&(clearInterval(h),h=null);for(const n of M)delete n.sprite;return e};function F(n){const u=n.getContext("2d",{willReadFrequently:!0});n.width=n.height=1;const y=Math.sqrt(u.getImageData(0,0,1,1).data.length>>2);return n.width=(O<<5)/y,n.height=W/y,u.fillStyle=u.strokeStyle="red",{context:u,ratio:y}}function P(n,u,y){for(var d=[{x:0,y:0},{x:r[0],y:r[1]}],k=u.x,q=u.y,m=Math.sqrt(r[0]*r[0]+r[1]*r[1]),T=w(r),o=z()<.5?1:-1,a=-o,_,x,v;(_=T(a+=o))&&(x=~~_[0],v=~~_[1],!(Math.min(Math.abs(x),Math.abs(v))>=m));)if(u.x=k+x,u.y=q+v,!(u.x+u.x0<0||u.y+u.y0<0||u.x+u.x1>r[0]||u.y+u.y1>r[1])&&(!y||st(u,y))&&!ot(u,n,r[0])){for(var U=u.sprite,S=u.width>>5,G=r[0]>>5,J=u.x-(S<<4),K=J&127,V=32-K,H=u.y1-u.y0,Z=(u.y+u.y0)*G+(J>>5),A,B=0;B<H;B++){A=0;for(var j=0;j<=S;j++)n[Z+j]|=A<<V|(j<S?(A=U[B*S+j])>>>K:0);Z+=G}return!0}return!1}return e.timeInterval=function(n){return arguments.length?(b=n??1/0,e):b},e.words=function(n){return arguments.length?(M=n,e):M},e.size=function(n){return arguments.length?(r=[+n[0],+n[1]],e):r},e.font=function(n){return arguments.length?(i=D(n),e):i},e.fontStyle=function(n){return arguments.length?(f=D(n),e):f},e.fontWeight=function(n){return arguments.length?(l=D(n),e):l},e.rotate=function(n){return arguments.length?(c=D(n),e):c},e.text=function(n){return arguments.length?(t=D(n),e):t},e.spiral=function(n){return arguments.length?(w=$[n]||n,e):w},e.fontSize=function(n){return arguments.length?(s=D(n),e):s},e.padding=function(n){return arguments.length?(g=D(n),e):g},e.random=function(n){return arguments.length?(z=n,e):z},e.on=function(){var n=p.on.apply(p,arguments);return n===p?e:n},e};function rt(r){return r.text}function nt(){return"serif"}function E(){return"normal"}function et(r){return Math.sqrt(r.value)}function at(){return(~~(random()*6)-3)*30}function ut(){return 1}function it(r,t,i,s){if(!t.sprite){var f=r.context,l=r.ratio;f.clearRect(0,0,(O<<5)/l,W/l);var c=0,g=0,w=0,M=i.length;for(--s;++s<M;){t=i[s],f.save(),f.font=t.style+" "+t.weight+" "+~~((t.size+1)/l)+"px "+t.font;const a=f.measureText(t.text),_=-Math.floor(a.width/2);let x=(a.width+1)*l,v=t.size<<1;if(t.rotate){var b=Math.sin(t.rotate*C),p=Math.cos(t.rotate*C),h=x*p,z=x*b,e=v*p,I=v*b;x=Math.max(Math.abs(h+I),Math.abs(h-I))+31>>5<<5,v=~~Math.max(Math.abs(z+e),Math.abs(z-e))}else x=x+31>>5<<5;if(v>w&&(w=v),c+x>=O<<5&&(c=0,g+=w,w=0),g+v>=W)break;f.translate((c+(x>>1))/l,(g+(v>>1))/l),t.rotate&&f.rotate(t.rotate*C),f.fillText(t.text,_,0),t.padding&&(f.lineWidth=2*t.padding,f.strokeText(t.text,_,0)),f.restore(),t.width=x,t.height=v,t.xoff=c,t.yoff=g,t.x1=x>>1,t.y1=v>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,c+=x}for(var F=f.getImageData(0,0,(O<<5)/l,W/l).data,P=[];--s>=0;)if(t=i[s],!!t.hasText){for(var n=t.width,u=n>>5,y=t.y1-t.y0,d=0;d<y*u;d++)P[d]=0;if(c=t.xoff,c==null)return;g=t.yoff;for(var k=0,q=-1,m=0;m<y;m++){for(var d=0;d<n;d++){var T=u*m+(d>>5),o=F[(g+m)*(O<<5)+(c+d)<<2]?1<<31-d%32:0;P[T]|=o,k|=o}k?q=m:(t.y0++,y--,m--,g++)}t.y1=t.y0+q,t.sprite=P.slice(0,(t.y1-t.y0)*u)}}}function ot(r,t,i){i>>=5;for(var s=r.sprite,f=r.width>>5,l=r.x-(f<<4),c=l&127,g=32-c,w=r.y1-r.y0,M=(r.y+r.y0)*i+(l>>5),b,p=0;p<w;p++){b=0;for(var h=0;h<=f;h++)if((b<<g|(h<f?(b=s[p*f+h])>>>c:0))&t[M+h])return!0;M+=i}return!1}function ft(r,t){var i=r[0],s=r[1];t.x+t.x0<i.x&&(i.x=t.x+t.x0),t.y+t.y0<i.y&&(i.y=t.y+t.y0),t.x+t.x1>s.x&&(s.x=t.x+t.x1),t.y+t.y1>s.y&&(s.y=t.y+t.y1)}function st(r,t){return r.x+r.x1>t[0].x&&r.x+r.x0<t[1].x&&r.y+r.y1>t[0].y&&r.y+r.y0<t[1].y}function Q(r){var t=r[0]/r[1];return function(i){return[t*(i*=.1)*Math.cos(i),i*Math.sin(i)]}}function lt(r){var t=4,i=t*r[0]/r[1],s=0,f=0;return function(l){var c=l<0?-1:1;switch(Math.sqrt(1+4*c*l)-c&3){case 0:s+=i;break;case 1:f+=t;break;case 2:s-=i;break;default:f-=t;break}return[s,f]}}function ct(r){for(var t=[],i=-1;++i<r;)t[i]=0;return t}function ht(){return document.createElement("canvas")}function D(r){return typeof r=="function"?r:function(){return r}}var yt=N(tt);export{yt as default};
